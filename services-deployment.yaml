#SERVICES RESOURCES
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nodejs-courses-api-deployment
spec:
  selector:
    matchLabels:
      app: nodejs-courses-api
  template:
    metadata:
      labels:
        app: nodejs-courses-api
    spec:
      containers:
        - name: nodejs-courses-api-container
          image: jcortizs/nodejs_courses_api
          env:
            - name: POSTGRES_HOST
              value: "postgresql-server-service"
            - name: POSTGRES_PORT
              value: "5432"
            - name: POSTGRES_USERNAME
              value: "postgres"
            - name: POSTGRES_PASSWORD
              value: "HDLCrin8*"
            #- name: postgresql-server
            #  value: postgresql-server-service
            - name: POSTGRES_DATABASE
              value: "courses_db"
          ports:
            - containerPort: 8090
            - containerPort: 5432
---
apiVersion: v1
kind: Service
metadata:
  name: nodejs-courses-api-service
spec:
  selector:
    app: nodejs-courses-api
  ports:
    - name: http
      protocol: TCP
      port: 8090
      targetPort: 8090
    - name: database
      protocol: TCP
      port: 5432
      targetPort: 5432
  type: LoadBalancer
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: dotnet-resources-api-deployment
spec:
  selector:
    matchLabels:
      app: dotnet-resources-api
  template:
    metadata:
      labels:
        app: dotnet-resources-api
    spec:
      containers:
        - name: dotnet-resources-api-container
          image: jcortizs/dotnet_resources_api
          env:
            - name: DBServer
              value: ms-sql-server-service
            #- name: ms-sql-server
            #  value: "ms-sql-server-service"
            - name: ConnectionStrings__DefaultConnection
              value: "Server=tcp:ms-sql-server-service,1433;Database=resources_db;Trusted_Connection=False;TrustServerCertificate=True;MultipleActiveResultSets=true;User ID=sa;Password=HDLCrin8*;"
          ports:
            - containerPort: 8080
            - containerPort: 1433
---
apiVersion: v1
kind: Service
metadata:
  name: dotnet-resources-api-service
spec:
  selector:
    app: dotnet-resources-api
  ports:
    - name: http
      protocol: TCP
      port: 8080
      targetPort: 8080
    - name: database
      protocol: TCP
      port: 1433
      targetPort: 1433
  type: LoadBalancer
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: django-gateway-api-deployment
spec:
  selector:
    matchLabels:
      app: django-gateway-api
  template:
    metadata:
      labels:
        app: django-gateway-api
    spec:
      containers:
        - name: django-gateway-api-container
          image: jcortizs/django_gateway_api
          ports:
            - containerPort: 8070
            - containerPort: 1544
            - containerPort: 8080
            - containerPort: 8090
            - containerPort: 8060
---
apiVersion: v1
kind: Service
metadata:
  name: django-gateway-api-service
spec:
  selector:
    app: django-gateway-api
  #  ports:
  #    - protocol: TCP
  #      port: 8070
  #      targetPort: 80
  ports:
    - name: http
      protocol: TCP
      port: 8070
      targetPort: 8070
    - name: port-1544
      protocol: TCP
      port: 1544
      targetPort: 1544
    - name: dotnet-resources-api-port
      protocol: TCP
      port: 8080
      targetPort: 8080
    - name: nodejs-courses-api-port
      protocol: TCP
      port: 8090
      targetPort: 8090
    - name: laravel-auth-api-port
      protocol: TCP
      port: 8060
      targetPort: 8060
  type: LoadBalancer
